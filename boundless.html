<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ— é™ä¹‹æ—… æˆ˜æœ¯ç»ˆç«¯</title>
    <style>
        :root {
            --bg-bezel: #121212;
            --bg-screen: #f0f2f5;
            --bg-sidebar: rgba(255, 255, 255, 0.9);
            --bg-header: #ffffff;
            --bg-card: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border: #e5e7eb;
            
            --primary: #2563eb;    /* ç§‘æŠ€è“ */
            --danger: #ef4444;     /* è­¦å‘Šçº¢ */
            --success: #10b981;    /* æˆåŠŸç»¿ */
            --accent: #8b5cf6;     /* ç´«è‰²ç‚¹ç¼€ */
            --energy: #f43f5e;     /* æœ¬æºèƒ½é‡è‰² */
            
            --radius-screen: 16px;
            --radius-card: 10px;
            --shadow-card: 0 1px 3px rgba(0,0,0,0.05);
            --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        }

        :root[data-theme="dark"] {
            --bg-bezel: #000000;
            --bg-screen: #18181b;
            --bg-sidebar: rgba(39, 39, 42, 0.95);
            --bg-header: #27272a;
            --bg-card: #27272a;
            --text-main: #f3f4f6;
            --text-sub: #9ca3af;
            --border: #3f3f46;
            --primary: #3b82f6;
            --danger: #f87171;
            --success: #34d399;
            --energy: #fb7185;
            --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: transparent;
            height: 100vh;
            overflow: hidden;
            margin: 0;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* å¹³æ¿å¤–å£³ */
        .tablet-device {
            width: 100%;
            height: auto;
            min-width: 320px;
            max-width: 1000px;
            max-height: 95vh;
            background: var(--bg-bezel);
            border-radius: 24px;
            padding: 10px;
            box-shadow: 0 0 0 2px #222, 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: flex;
            position: relative;
        }
        
        /* æ‘„åƒå¤´ç‚¹ç¼€ */
        .tablet-camera {
            position: absolute;
            left: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 30px;
            background: #333;
            border-radius: 2px 0 0 2px;
        }

        /* å±å¹•åŒºåŸŸ */
        .tablet-screen {
            width: 100%;
            height: 100%;
            max-height: 800px;
            background: var(--bg-screen);
            border-radius: var(--radius-screen);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- æ–°çš„é¡¶éƒ¨ HUD æ  (æ›¿ä»£æ‰‹æœºçŠ¶æ€æ ) --- */
        .hud-header {
            height: 48px;
            background: var(--bg-header);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            flex-shrink: 0;
            z-index: 20;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .hud-left { display: flex; align-items: center; gap: 15px; }
        .hud-right { display: flex; align-items: center; gap: 15px; }

        .hud-item {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .hud-label { font-size: 10px; color: var(--text-sub); text-transform: uppercase; line-height: 1; margin-bottom: 2px; }
        .hud-value { font-size: 14px; font-weight: 700; color: var(--text-main); white-space: nowrap; }
        
        /* èƒ½é‡é«˜äº® */
        .energy-display {
            background: rgba(244, 63, 94, 0.1);
            padding: 4px 12px;
            border-radius: 6px;
            border: 1px solid rgba(244, 63, 94, 0.2);
        }
        .energy-display .hud-value { color: var(--energy); }

        /* App å¸ƒå±€ */
        .app-layout {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 200px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 16px 10px;
            gap: 6px;
            flex-shrink: 0;
            backdrop-filter: blur(10px);
        }

        .brand {
            padding: 0 10px 16px 10px;
            font-size: 18px;
            font-weight: 800;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 8px;
        }

        .nav-item {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-sub);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.15s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover { background: rgba(0,0,0,0.04); color: var(--text-main); }
        :root[data-theme="dark"] .nav-item:hover { background: rgba(255,255,255,0.08); }
        .nav-item.active { background: var(--primary); color: white; box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3); }

        /* å†…å®¹åŒº */
        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        /* ä»ªè¡¨ç›˜ Widget */
        .dashboard-widgets {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .widget-card {
            background: var(--bg-card);
            padding: 14px 18px;
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* æ—¥å¿—çª—å£ - ç®€æ´ç‰ˆï¼ˆä»¿åŸç‰ˆï¼‰ */
        .terminal-widget {
            grid-column: span 2;
            background: var(--bg-card);
            border-radius: var(--radius-card);
            border: 1px solid var(--border);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-card);
        }

        .terminal-header {
            background: var(--bg-card);
            padding: 10px 14px;
            font-size: 0.9rem;
            color: var(--text-main);
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .terminal-content {
            padding: 12px 14px;
            font-size: 0.85rem;
            line-height: 1.6;
            min-height: 100px;
            max-height: 250px;
            overflow-y: auto;
            color: var(--text-main);
        }

        /* æ—¥å¿—é«˜äº®ç±» - ç®€æ´ç‰ˆ */
        .log-section { 
            margin-bottom: 8px;
        }
        .log-key { 
            color: var(--text-main); 
            font-weight: 600; 
            font-size: 0.85rem;
            margin-bottom: 2px;
        }
        .log-time { 
            color: var(--text-sub);
            font-size: 0.8rem;
            margin-bottom: 6px;
        }

        /* é€šç”¨å¡ç‰‡ */
        .ios-card {
            background: var(--bg-card);
            border-radius: var(--radius-card);
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border);
        }

        .card-header {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* å±æ€§ç½‘æ ¼ */
        .stat-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; }
        .stat-box { background: rgba(0,0,0,0.03); padding: 8px 4px; border-radius: 8px; text-align: center; }
        .stat-val { font-size: 15px; font-weight: 700; color: var(--text-main); }
        .stat-lbl { font-size: 10px; color: var(--text-sub); margin-top: 2px; }

        /* åˆ—è¡¨é¡¹ - å¡ç‰‡æ ·å¼ */
        .list-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }
        .list-item:last-child { border-bottom: none; }
        .item-row { display: flex; justify-content: space-between; align-items: center; }
        .item-main { font-size: 13px; font-weight: 600; color: var(--text-main); }
        .item-sub { font-size: 12px; color: var(--text-sub); }
        
        /* ç²¾ç¾å¡ç‰‡æ ·å¼ (ç”¨äºNPC/åŠ¿åŠ›/æˆå‘˜ç­‰) */
        .item-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-card);
            padding: 10px 12px;
            margin-bottom: 8px;
            transition: all 0.2s;
            position: relative;
        }
        .item-card:hover {
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.15);
        }
        .item-card:last-child { margin-bottom: 0; }
        
        .card-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }
        .card-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-main);
            flex: 1;
        }
        .card-info-line {
            font-size: 0.8rem;
            color: var(--text-sub);
            line-height: 1.4;
            margin-bottom: 4px;
        }
        .card-section {
            margin-top: 8px;
            padding-left: 10px;
            border-left: 2px solid var(--border);
            font-size: 0.82rem;
        }
        .card-section-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-main);
        }
        .card-section-content {
            color: var(--text-sub);
            line-height: 1.5;
            margin-bottom: 4px;
        }
        
        /* è¯¦æƒ…æŠ˜å  */
        .item-details, .card-details {
            display: none;
            margin-top: 8px;
            padding: 8px 10px;
            background: rgba(0,0,0,0.03);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-sub);
            line-height: 1.5;
        }
        .item-details.active, .card-details.active { display: block; animation: slideDown 0.2s; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-3px); } to { opacity: 1; transform: translateY(0); } }
        
        .card-arrow {
            position: absolute;
            right: 10px;
            top: 10px;
            font-size: 0.7rem;
            color: var(--text-sub);
            transition: transform 0.2s;
        }
        .item-card.open .card-arrow { transform: rotate(180deg); }

        /* è¿›åº¦æ¡ */
        .bar-wrap { margin-bottom: 10px; }
        .bar-info { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; color: var(--text-sub); }
        .bar-bg { height: 6px; background: rgba(0,0,0,0.08); border-radius: 3px; overflow: hidden; }
        .bar-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }

        /* æ ‡ç­¾ */
        .tag { padding: 1px 5px; border-radius: 4px; font-size: 10px; background: rgba(0,0,0,0.05); color: var(--text-sub); border: 1px solid rgba(0,0,0,0.05); }
        
        /* é¡µé¢åˆ‡æ¢ */
        .page-view { display: none; }
        .page-view.active { display: block; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 2px; }

        .arrow { font-size: 10px; color: var(--text-sub); transition: transform 0.2s; }
        .list-item.open .arrow { transform: rotate(180deg); }

        .empty-tip { text-align: center; color: var(--text-sub); padding: 15px; font-size: 12px; font-style: italic; }
        .error-tip { background: #fee2e2; color: #b91c1c; padding: 10px; border-radius: 8px; font-size: 12px; }
        
        /* æ‰‹æœºç«¯ä¸“å±ç•Œé¢ */
        @media (max-width: 768px) {
            html, body {
                height: 100vh;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
            
            body {
                background: var(--bg-screen);
            }
            
            /* éšè—å¹³æ¿å¤–å£³ */
            .tablet-device {
                width: 100%;
                height: 100vh;
                max-width: 100%;
                padding: 0;
                border-radius: 0;
                box-shadow: none;
                background: var(--bg-screen);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            }
            
            .tablet-camera {
                display: none;
            }
            
            .tablet-screen {
                width: 100%;
                height: 100%;
                border-radius: 0;
                background: var(--bg-screen);
            display: flex;
            flex-direction: column;
                overflow: hidden;
            }
            
            /* HUD é¡¶éƒ¨æ  - æ‰‹æœºç‰ˆä¼˜åŒ– */
            .hud-header {
                height: auto;
                min-height: 48px;
                padding: 10px 12px;
                margin: 0;
                flex-wrap: wrap;
                gap: 8px;
                flex-shrink: 0;
            }
            
            .hud-left {
                flex: 1;
                min-width: 0;
            gap: 10px;
        }
            
            .hud-right {
                gap: 8px;
            }
            
            .hud-item {
                min-width: 0;
            }
            
            .hud-label {
                font-size: 9px;
            }
            
            .hud-value {
                font-size: 12px;
            overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            .energy-display {
                padding: 4px 10px;
            }
            
            /* éšè— Widget ä»ªè¡¨ç›˜ */
            .dashboard-widgets {
                display: none;
            }
            
            /* å¸ƒå±€è°ƒæ•´ */
            .app-layout {
                flex: 1;
            flex-direction: column;
                height: 100%;
                margin: 0;
                padding: 0;
                display: flex;
                overflow: hidden;
            }
            
            /* ä¾§è¾¹æ æ”¹ä¸ºåº•éƒ¨å¯¼èˆª */
            .sidebar {
                width: 100%;
                height: 60px;
                flex-direction: row;
                justify-content: space-around;
                padding: 0;
                margin: 0;
                gap: 0;
                order: 2;
                overflow-x: visible;
                overflow-y: hidden;
                border-right: none;
                border-top: 1px solid var(--border);
                background: var(--bg-sidebar);
                box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
                flex-shrink: 0;
            }
            
            .brand {
                display: none;
            }
            
            .nav-item {
                flex: 1;
            flex-direction: column;
                justify-content: center;
                align-items: center;
                padding: 8px 4px;
                font-size: 10px;
                white-space: nowrap;
                border-radius: 0;
            gap: 4px;
        }
            
            .nav-item span {
                font-size: 20px;
                margin: 0;
            }
            
            .nav-item:hover {
                background: transparent;
            }
            
            .nav-item.active {
                background: transparent;
                border: none;
            box-shadow: none;
                color: var(--primary);
            }
            
            /* å†…å®¹åŒº */
            .content-area {
                flex: 1;
                padding: 0;
                margin: 0;
                order: 1;
                overflow-y: auto;
                background: var(--bg-screen);
                -webkit-overflow-scrolling: touch;
            }
            
            /* é¡µé¢è§†å›¾ */
            .page-view {
                padding: 12px;
                padding-bottom: 0;
            }
            
            /* å¡ç‰‡æ ·å¼ - æ‰‹æœºç‰ˆï¼ˆä¿ç•™è¾¹æ¡†ï¼‰ */
            .ios-card {
                padding: 14px;
                margin-bottom: 12px;
                border-radius: 12px;
                background: var(--bg-card);
                border: 1px solid var(--border);
                box-shadow: var(--shadow-card);
            }
            
            .ios-card:last-child {
                margin-bottom: 0;
            }
            
            .card-header {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            /* ç»ˆç«¯æ—¥å¿— - æ‰‹æœºç‰ˆ */
            .terminal-widget {
                grid-column: span 1;
                margin: 0 12px 12px 12px;
                border-radius: 12px;
            }
            
            .terminal-header {
                padding: 10px 12px;
                font-size: 13px;
            }
            
            .terminal-content {
                padding: 12px;
                max-height: 200px;
                font-size: 0.82rem;
            }
            
            /* å±æ€§ç½‘æ ¼ */
            .stat-grid {
                grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
            
            .stat-box {
                padding: 8px 4px;
            border-radius: 10px;
            }
            
            .stat-val {
                font-size: 15px;
            }
            
            .stat-lbl {
                font-size: 10px;
            }
            
            /* è¿›åº¦æ¡ */
            .bar-wrap {
                margin-bottom: 12px;
            }
            
            .bar-info {
                font-size: 11px;
                margin-bottom: 6px;
            }
            
            .bar-bg {
                height: 6px;
            }
            
            /* å¡ç‰‡æ ·å¼ */
            .item-card {
                padding: 10px 12px;
                margin-bottom: 8px;
            border-radius: 10px;
            }
            
            .card-title {
                font-size: 0.95rem;
            }
            
            .card-info-line {
                font-size: 0.8rem;
            }
            
            .card-section {
                font-size: 0.82rem;
                padding-left: 10px;
                margin-top: 8px;
            }
            
            .card-section-title {
                font-size: 0.85rem;
            }
            
            .card-section-content {
                font-size: 0.8rem;
            }
            
            /* åˆ—è¡¨é¡¹ */
            .list-item {
                padding: 10px 0;
            }
            
            .item-main {
                font-size: 13px;
            }
            
            .item-sub {
                font-size: 12px;
            }
            
            /* æ ‡ç­¾ */
            .tag {
                font-size: 10px;
                padding: 2px 6px;
            }
            
            /* Widget å¡ç‰‡ */
            .widget-card {
                display: none;
            }
        }
        
        /* å°å±æ‰‹æœºä¼˜åŒ– */
        @media (max-width: 480px) {
            .content-area {
                padding: 0;
            }
            
            .page-view {
                padding: 10px;
            }
            
            .stat-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .nav-item {
                font-size: 9px;
            }
            
            .nav-item span {
                font-size: 18px;
            }
            
            .ios-card {
                padding: 12px;
            }
        }
    </style>
</head>
<body>

<div class="tablet-device">
    <div class="tablet-camera"></div>
    <div class="tablet-screen">
        
        <!-- å…¨å±€ HUD é¡¶éƒ¨æ  (æ›¿ä»£æ‰‹æœºçŠ¶æ€æ ) -->
        <header class="hud-header">
            <div class="hud-left">
                <div class="hud-item">
                    <span class="hud-label">æ ¸å¿ƒä»£å·</span>
                    <span class="hud-value" id="hud-name">UNKNOWN</span>
        </div>
                <div class="hud-item" style="border-left: 1px solid var(--border); padding-left: 15px;">
                    <span class="hud-label">å½“å‰ä½ç½®</span>
                    <span class="hud-value" id="hud-location">æœªå®šä½</span>
        </div>
        </div>
            
            <div class="hud-right">
                <div class="hud-item energy-display">
                    <span class="hud-label">æœ¬æºèƒ½é‡</span>
                    <span class="hud-value" id="hud-energy">0 pts</span>
        </div>
    </div>
        </header>

        <div class="app-layout">
            <!-- ä¾§è¾¹å¯¼èˆª -->
            <nav class="sidebar">
                <div class="brand">
                    <span style="color: var(--primary);">â–</span> æ— é™ä¹‹æ—…
        </div>
                
                <button class="nav-item active" onclick="switchPage('captain', this)"><span>ğŸ‘¤</span> ç©å®¶çŠ¶æ€</button>
                <button class="nav-item" onclick="switchPage('equipment', this)"><span>ğŸ’</span> ç‰©èµ„ä»“åº“</button>
                <button class="nav-item" onclick="switchPage('spatial', this)"><span>ğŸ›¸</span> è½½å…·ä¸­å¿ƒ</button>
                <button class="nav-item" onclick="switchPage('social', this)"><span>ğŸŒ</span> ä¸–ç•Œæƒ…æŠ¥</button>
                <button class="nav-item" onclick="switchPage('characters', this)"><span>ğŸ‘¥</span> ç¤¾äº¤å›¾è°±</button>
                <button class="nav-item" onclick="switchPage('missions', this)"><span>ğŸ“œ</span> å‘½è¿æ¸…å•</button>
                
                <div style="margin-top: auto;">
                    <button class="nav-item" onclick="toggleTheme()"><span>ğŸŒ“</span> æ¨¡å¼åˆ‡æ¢</button>
    </div>
            </nav>

            <!-- ä¸»å†…å®¹åŒº -->
            <main class="content-area">
                
                <!-- é¡¶éƒ¨ä»ªè¡¨ç›˜ Widget -->
                <div class="dashboard-widgets">
                    <!-- Widget 1: ä¸–ç•Œä¿¡æ¯ (å–ä»£äº†åŸæœ¬çš„èƒ½é‡æ˜¾ç¤ºä½ç½®) -->
                    <div class="widget-card">
                        <div class="hud-label">ç›®æ ‡ä¸–ç•Œ</div>
                        <div class="hud-value" id="widget-world-name" style="font-size: 16px; margin-bottom: 5px;">æœªé”šå®š</div>
                        <div style="display: flex; justify-content: space-between; margin-top: auto;">
                            <span class="hud-label">å½“åœ°èµ„é‡‘</span>
                            <span class="item-main" id="widget-currency">-</span>
                        </div>
                        </div>

                    <!-- Widget 2: è¯¦ç»†ä½ç½®/çŠ¶æ€ -->
                    <div class="widget-card">
                        <div class="hud-label">è¯¦ç»†åæ ‡</div>
                        <div class="item-sub" id="widget-location-full" style="line-height: 1.4; margin-top: 2px;">æ­£åœ¨è·å–ç©ºé—´åæ ‡...</div>
                         <div style="display: flex; justify-content: space-between; margin-top: auto;">
                            <span class="hud-label">è½½å…·çŠ¶æ€</span>
                            <span class="item-main" id="widget-vina-status">å¾…æœº</span>
                    </div>
                        </div>

                    <!-- Widget 3: ç»ˆç«¯æ—¥å¿— (å®½å±) -->
                    <div class="terminal-widget">
                        <div class="terminal-header">
                            <span>> SYSTEM_LOG</span>
                            <span>â— REC</span>
                        </div>
                        <div class="terminal-content" id="terminal-log">
                            ç³»ç»Ÿåˆå§‹åŒ–ä¸­...
                    </div>
                </div>
                        </div>

                <!-- é¡µé¢å†…å®¹å®¹å™¨ -->
                <div id="page-container">
                    
                    <!-- 1. ç©å®¶çŠ¶æ€ -->
                    <div id="page-captain" class="page-view active">
                        <div class="ios-card">
                            <div class="card-header">æ ¸å¿ƒçŠ¶æ€</div>
                            <div class="bar-wrap">
                                <div class="bar-info"><span>HP (ç”Ÿå‘½å€¼)</span><span id="hp-text">100/100</span></div>
                                <div class="bar-bg"><div id="hp-bar" class="bar-fill" style="width: 100%; background: var(--danger);"></div></div>
                        </div>
                            <div class="bar-wrap" style="margin-bottom: 0;">
                                <div class="bar-info"><span>LINK (åŒæ­¥ç‡)</span><span id="link-text">0/1000</span></div>
                                <div class="bar-bg"><div id="link-bar" class="bar-fill" style="width: 0%; background: var(--success);"></div></div>
                        </div>
                        </div>

                        <div class="ios-card">
                            <div class="card-header">å…­ç»´å±æ€§</div>
                            <div class="stat-grid">
                                <div class="stat-box"><div class="stat-val" id="val-str">-</div><div class="stat-lbl">åŠ›é‡</div></div>
                                <div class="stat-box"><div class="stat-val" id="val-def">-</div><div class="stat-lbl">é˜²å¾¡</div></div>
                                <div class="stat-box"><div class="stat-val" id="val-agi">-</div><div class="stat-lbl">æ•æ·</div></div>
                                <div class="stat-box"><div class="stat-val" id="val-chr">-</div><div class="stat-lbl">é­…åŠ›</div></div>
                                <div class="stat-box"><div class="stat-val" id="val-luk">-</div><div class="stat-lbl">å¹¸è¿</div></div>
                                <div class="stat-box"><div class="stat-val" id="val-world">0</div><div class="stat-lbl">ä¸–ç•Œ</div></div>
                        </div>
                        </div>

                        <div class="ios-card">
                            <div class="card-header">å¤©èµ‹ (Passive)</div>
                            <div id="list-talents"></div>
                    </div>
                        <div class="ios-card">
                            <div class="card-header">èƒ½åŠ› (Active)</div>
                            <div id="list-abilities"></div>
                </div>
                        </div>

                    <!-- 2. ç‰©èµ„ä»“åº“ -->
                    <div id="page-equipment" class="page-view">
                        <div class="ios-card">
                            <div class="card-header">è£…å¤‡æ§½ä½</div>
                            <div id="list-equip-slots"></div>
                        </div>
                        <div class="ios-card">
                            <div class="card-header">èƒŒåŒ…æ¸…å•</div>
                            <div id="list-inventory"></div>
                    </div>
                </div>

                    <!-- 3. è½½å…·ä¸­å¿ƒ -->
                    <div id="page-spatial" class="page-view">
                        <div class="ios-card">
                            <div class="card-header">æ ¸å¿ƒæ¦‚å†µ</div>
                            <div class="stat-grid" style="grid-template-columns: repeat(4, 1fr);">
                                <div class="stat-box"><div class="stat-val" id="veh-type" style="font-size: 13px;">-</div><div class="stat-lbl">ç±»å‹</div></div>
                                <div class="stat-box"><div class="stat-val" id="veh-core" style="font-size: 13px;">-</div><div class="stat-lbl">ä»£å·</div></div>
                                <div class="stat-box"><div class="stat-val" id="veh-status" style="font-size: 13px;">-</div><div class="stat-lbl">çŠ¶æ€</div></div>
                                <div class="stat-box"><div class="stat-val" id="veh-stage">0</div><div class="stat-lbl">é˜¶æ®µ</div></div>
        </div>
                            <div class="bar-wrap" style="margin-top: 15px; margin-bottom: 0;">
                                <div class="bar-info"><span>ç‰©ç†ç©ºé—´å ç”¨</span><span id="space-text">0/0 SU</span></div>
                                <div class="bar-bg"><div id="space-bar" class="bar-fill" style="width: 0%; background: var(--primary);"></div></div>
                        </div>
                        </div>
                        <div class="ios-card">
                            <div class="card-header">å»ºç­‘å¸ƒå±€</div>
                            <div id="list-buildings"></div>
                        </div>
                        <div class="ios-card">
                            <div class="card-header">æˆå‘˜ç®¡ç†</div>
                            <div id="list-members"></div>
                        </div>
                    </div>

                    <!-- 4. ä¸–ç•Œæƒ…æŠ¥ -->
                    <div id="page-social" class="page-view">
                        <div class="ios-card">
                            <div class="card-header">ä¸–ç•Œå‚æ•°</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div class="list-item" style="border:none; padding:0;"><span class="item-sub">æ–‡æ˜ç±»å‹:</span> <span class="item-main" id="world-civ">-</span></div>
                                <div class="list-item" style="border:none; padding:0;"><span class="item-sub">ä¼ªè£…èº«ä»½:</span> <span class="item-main" id="world-id">-</span></div>
                                <div class="list-item" style="border:none; padding:0;"><span class="item-sub">å‰§æƒ…èŠ‚ç‚¹:</span> <span class="item-main" id="world-node">-</span></div>
                                <div class="list-item" style="border:none; padding:0;"><span class="item-sub">åŠ›é‡å±‚çº§:</span> <span class="item-main" id="world-level">-</span></div>
                </div>
                </div>
                        <div class="ios-card">
                            <div class="card-header">è¯¦ç»†æ¡£æ¡ˆ</div>
                            <div class="list-item" onclick="toggleDetails(this)">
                                <div class="item-row"><span class="item-main">ä¸–ç•ŒèƒŒæ™¯è®¾å®š</span><span class="arrow">â–¼</span></div>
                                <div class="item-details" id="world-bg-text">æš‚æ— </div>
        </div>
                            <div class="list-item" onclick="toggleDetails(this)">
                                <div class="item-row"><span class="item-main">åŠ›é‡ä½“ç³»</span><span class="arrow">â–¼</span></div>
                                <div class="item-details" id="world-power-text">æš‚æ— </div>
                        </div>
                        </div>
                        </div>

                    <!-- 5. ç¤¾äº¤å›¾è°± -->
                    <div id="page-characters" class="page-view">
                        <div class="ios-card">
                            <div class="card-header">è§’è‰²å½• (NPC)</div>
                            <div id="list-npcs"></div>
                        </div>
                        <div class="ios-card">
                            <div class="card-header">åŠ¿åŠ›æ¡£æ¡ˆ</div>
                            <div id="list-factions"></div>
                    </div>
                </div>

                    <!-- 6. å‘½è¿æ¸…å• -->
                    <div id="page-missions" class="page-view">
                        <div class="ios-card">
                            <div class="card-header">å‘½è¿çº¿</div>
                            <div id="list-missions"></div>
                        </div>
                        </div>

                    </div>
            </main>
                        </div>
                        </div>
</div>

<script>
    // --- UI é€»è¾‘ ---
    function switchPage(pageId, btn) {
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.page-view').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
    }

    function toggleTheme() {
        const root = document.documentElement;
        root.setAttribute('data-theme', root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    }

    function toggleDetails(el) {
        const details = el.querySelector('.item-details');
        const arrow = el.querySelector('.arrow');
        if (details) {
            if (details.classList.contains('active')) {
                details.classList.remove('active');
                el.classList.remove('open');
        } else {
                details.classList.add('active');
                el.classList.add('open');
            }
        }
    }
    
    function toggleCardDetails(el) {
        const details = el.querySelector('.card-details');
        const arrow = el.querySelector('.card-arrow');
        if (details) {
            if (details.classList.contains('active')) {
                details.classList.remove('active');
                details.style.display = 'none';
                el.classList.remove('open');
            } else {
                details.classList.add('active');
                details.style.display = 'block';
                el.classList.add('open');
            }
        }
    }

    // --- å®‰å…¨æ•°æ®è¯»å– (ä¿®å¤æŠ¥é”™çš„æ ¸å¿ƒ) ---
    function SafeGet(obj, path, def = "N/A") {
        if (!obj) return def;
        let keys = Array.isArray(path) ? path : path.split('.');
        let cur = obj;
        for (let k of keys) {
            if (cur === undefined || cur === null || typeof cur !== 'object') return def;
            cur = cur[k];
        }
        if (cur === undefined || cur === null || cur === '$meta') return def;
        if (Array.isArray(cur)) return cur.length > 0 ? String(cur[0]) : def;
        if (typeof cur === 'object') return JSON.stringify(cur);
        return String(cur);
    }

    function SafeGetFallback(obj, paths, def) {
        for(let p of paths) {
            let res = SafeGet(obj, p, null);
            if(res !== null && res !== 'N/A') return res;
        }
        return def;
    }

    // --- ä¸»é€»è¾‘ ---
    async function initDisplay() {
        try {
            const msgs = await getChatMessages(getCurrentMessageId());
            if (!msgs || !msgs[0] || !msgs[0].data) return;
            const data = msgs[0].data.stat_data;
            if (!data) throw new Error("Stat data missing");

            // 1. HUD & é¡¶éƒ¨æ  (é‡æ–°å¸ƒå±€)
            const energy = SafeGet(data, 'æœ¬æºèƒ½é‡', '0');
            document.getElementById('hud-energy').innerText = energy + ' pts';
            
            const location = SafeGet(data, 'å½“å‰ä½ç½®', 'æœªçŸ¥');
            document.getElementById('hud-location').innerText = location.length > 10 ? location.substring(0, 10) + '...' : location;
            document.getElementById('widget-location-full').innerText = location;

            const playerName = SafeGetFallback(data, ['è½½å…·æ ¸å¿ƒ.æ ¸å¿ƒåç§°', 'ä¸»è§’å±æ€§.å§“å'], 'ADMIN');
            document.getElementById('hud-name').innerText = playerName;

            document.getElementById('widget-world-name').innerText = SafeGet(data, 'å½“å‰ä¸–ç•Œä¿¡æ¯.ä¸–ç•Œåç§°', 'æœªé”šå®š');
            document.getElementById('widget-vina-status').innerText = SafeGetFallback(data, ['è½½å…·æ ¸å¿ƒ.å½“å‰çŠ¶æ€'], 'å¾…æœº');

            const currency = data['ä¸–ç•Œè´§å¸'] || {};
            const curStr = Object.entries(currency)
                .filter(([k]) => k !== '$meta')
                .map(([k,v]) => `${v} ${k}`).join(' | ') || '0';
            document.getElementById('widget-currency').innerText = curStr;

            // 2. æ—¥å¿— (ç®€æ´ç‰ˆ - ä»¿åŸç‰ˆ)
            const logRaw = SafeGetFallback(data, ['è½½å…·æ ¸å¿ƒ.å½“å‰æ—¥å¿—', 'è½½å…·æ ¸å¿ƒ.æ—¥å¿—'], '');
            const logEl = document.getElementById('terminal-log');
            if (logRaw) {
                let html = '';
                let str = String(logRaw);
                
                // æå–ä¸–ç•Œæ»ç•™æ—¶é—´
                const stayTimeMatch = str.match(/ã€ä¸–ç•Œæ»ç•™æ—¶é—´[ï¼š:]([^ã€‘]+)ã€‘/);
                if (stayTimeMatch) {
                    html += `<div class="log-time">ä¸–ç•Œæ»ç•™æ—¶é—´: ${stayTimeMatch[1]}</div>`;
                }
                
                // æå–ä¸–ç•Œå½“å‰æ—¶é—´
                const currentTimeMatch = str.match(/ã€ä¸–ç•Œå½“å‰æ—¶é—´[ï¼š:]([^ã€‘]+)ã€‘/);
                if (currentTimeMatch) {
                    html += `<div class="log-time">ä¸–ç•Œå½“å‰æ—¶é—´: ${currentTimeMatch[1]}</div>`;
                }
                
                // ç§»é™¤æ—¶é—´æ ‡è®°
                str = str.replace(/ã€ä¸–ç•Œæ»ç•™æ—¶é—´[ï¼š:][^ã€‘]+ã€‘/g, '');
                str = str.replace(/ã€ä¸–ç•Œå½“å‰æ—¶é—´[ï¼š:][^ã€‘]+ã€‘/g, '');
                
                // æå–æ—¶é—´æ¨ç†
                const reasoningMatch = str.match(/æ—¶é—´æ¨ç†[ï¼š:](.*?)(?=æœ¬å›åˆæ€»ç»“|è¯„ä»·|å»ºè®®|$)/s);
                if (reasoningMatch) {
                    const reasoning = reasoningMatch[1].trim();
                    if (reasoning) {
                        html += `<div class="log-section"><div class="log-key">æ—¶é—´æ¨ç†:</div><div>${reasoning}</div></div>`;
                    }
                }
                
                // æå–æœ¬å›åˆæ€»ç»“
                const summaryMatch = str.match(/æœ¬å›åˆæ€»ç»“[ï¼š:](.*?)(?=è¯„ä»·|å»ºè®®|$)/s);
                if (summaryMatch) {
                    let summary = summaryMatch[1].trim();
                    summary = summary.split('\n').filter(line => {
                        const trimmed = line.trim();
                        return trimmed && !trimmed.startsWith('è¯„ä»·') && !trimmed.startsWith('å»ºè®®');
                    }).join('\n');
                    if (summary) {
                        html += `<div class="log-section"><div class="log-key">æœ¬å›åˆæ€»ç»“:</div><div>${summary}</div></div>`;
                    }
                }
                
                // æå–è¯„ä»·
                const evalMatch = str.match(/è¯„ä»·[ï¼š:](.*?)(?=å»ºè®®|$)/s);
                if (evalMatch) {
                    let evaluation = evalMatch[1].trim();
                    const suggestionIndex = evaluation.search(/å»ºè®®[ï¼š:]/);
                    if (suggestionIndex !== -1) {
                        evaluation = evaluation.substring(0, suggestionIndex).trim();
                    }
                    evaluation = evaluation.split('\n').filter(line => {
                        const trimmed = line.trim();
                        return trimmed && !trimmed.startsWith('å»ºè®®');
                    }).join('\n');
                    if (evaluation) {
                        html += `<div class="log-section"><div class="log-key">è¯„ä»·:</div><div>${evaluation}</div></div>`;
                    }
                }
                
                // æå–å»ºè®®
                const suggestionMatch = str.match(/å»ºè®®[ï¼š:](.*?)$/s);
                if (suggestionMatch) {
                    const suggestion = suggestionMatch[1].trim();
                    if (suggestion) {
                        html += `<div class="log-section"><div class="log-key">å»ºè®®:</div><div>${suggestion}</div></div>`;
                    }
                }
                
                // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•ç»“æ„åŒ–å†…å®¹ï¼Œæ˜¾ç¤ºåŸå§‹æ–‡æœ¬
                if (!html) {
                    html = `<div>${str.replace(/\\n/g, '<br>').replace(/\n/g, '<br>')}</div>`;
                }
                
                logEl.innerHTML = html;
            } else {
                logEl.innerHTML = '<div style="opacity:0.5;">ç³»ç»Ÿå¾…æœºä¸­...</div>';
            }

            // 3. ç©å®¶å±æ€§
            const hpC = parseFloat(SafeGet(data, 'ä¸»è§’å±æ€§.ç”Ÿå‘½å€¼.å½“å‰å€¼', 100));
            const hpM = parseFloat(SafeGet(data, 'ä¸»è§’å±æ€§.ç”Ÿå‘½å€¼.æœ€å¤§å€¼', 100));
            document.getElementById('hp-text').innerText = `${hpC}/${hpM}`;
            document.getElementById('hp-bar').style.width = Math.min(100, (hpC/hpM)*100) + '%';
            
            const link = parseFloat(SafeGet(data, 'è½½å…·åŒæ­¥ç‡', 0));
            document.getElementById('link-text').innerText = `${link}/1000`;
            document.getElementById('link-bar').style.width = Math.min(100, (link/1000)*100) + '%';

            ['str','def','agi','chr','luk'].forEach(k => {
                const map = {str:'åŠ›é‡',def:'é˜²å¾¡',agi:'æ•æ·',chr:'é­…åŠ›',luk:'å¹¸è¿'};
                const base = SafeGet(data, `ä¸»è§’å±æ€§.${map[k]}.åŸºç¡€å€¼`, 0);
                const buff = SafeGet(data, `ä¸»è§’å±æ€§.${map[k]}.åŠ æˆå€¼`, 0);
                document.getElementById(`val-${k}`).innerText = buff != 0 ? `${base}+${buff}` : base;
            });
            document.getElementById('val-world').innerText = SafeGet(data, 'ä¸»è§’å±æ€§.å·²åˆ°è¾¾ä¸–ç•Œæ•°é‡', 0);

            // 4. å¤©èµ‹ä¸èƒ½åŠ› (ç²¾ç¾å¡ç‰‡æ ·å¼)
            const renderList = (arrRaw, elId, type) => {
                const el = document.getElementById(elId);
                const arr = Array.isArray(arrRaw) ? arrRaw : (arrRaw ? [arrRaw] : []);
                
                if (arr.length === 0) {
                    el.innerHTML = '<div class="empty-tip">æ— æ•°æ®</div>';
                    return;
                }

                el.innerHTML = arr.map(item => {
                    if (!item) return ''; 
                    
                    const name = item.åç§° || item.name || 'æœªçŸ¥';
                    const effect = item.æ•ˆæœ || item.effect || '';
                    const cost = item.æ¶ˆè€— || item.cost || '';
                    const cooldown = item.å†·å´ || item.cooldown || '';
                    const level = item.ç­‰çº§ || item.level || '';
                    const origin = item.æ¥æºä¸–ç•Œ || item.origin || '';
                    const description = item.æè¿° || item.description || '';
                    const condition = item.è§¦å‘æ¡ä»¶ || item.condition || '';
                    
                    const hasDetails = description || effect || condition || cost || cooldown || origin;
                    
                    let html = `<div class="item-card" ${hasDetails ? 'style="cursor:pointer;" onclick="toggleCardDetails(this)"' : ''}>`;
                    html += `<div class="card-title" style="padding-right: 20px;">${name}`;
                    if (level) html += ` <span class="tag">Lv.${level}</span>`;
                    if (cost) html += ` <span class="tag">æ¶ˆè€—:${cost}</span>`;
                    if (hasDetails) {
                        html += ' <span class="card-arrow">â–¼</span>';
                    }
                    html += '</div>';
                    
                    if (hasDetails) {
                        html += '<div class="card-details">';
                        html += '<div class="card-section">';
                        if (description) html += `<div class="card-section-content">${description}</div>`;
                        if (effect) html += `<div class="card-section-content">æ•ˆæœ: ${effect}</div>`;
                        if (condition) html += `<div class="card-section-content">è§¦å‘æ¡ä»¶: ${condition}</div>`;
                        if (cooldown) html += `<div class="card-section-content">å†·å´: ${cooldown}</div>`;
                        if (origin) html += `<div class="card-section-content">æ¥æº: ${origin}</div>`;
                        html += '</div>';
                        html += '</div>';
                    }
                    
                    html += '</div>';
                    return html;
                }).join('');
            };
            renderList(data['å¤©èµ‹æ '], 'list-talents');
            renderList(data['èƒ½åŠ›æ '], 'list-abilities');

            // 5. è£…å¤‡æ§½ä½ (ç²¾ç¾å¡ç‰‡æ ·å¼)
            const equip = data['ä¸»è§’è£…å¤‡æ '] || {};
            const equipSlots = ['æ­¦å™¨', 'é˜²å…·', 'æœè£…', 'é¥°å“'];
            document.getElementById('list-equip-slots').innerHTML = equipSlots.map(slot => {
                const item = equip[slot];
                let name = 'ç©º';
                let hasDetails = false;
                let quality = '';
                let desc = '';
                let effect = '';
                let origin = '';
                let type = '';
                
                if (item && item !== 'ç©º') {
                    if (typeof item === 'string') {
                        name = item;
                } else {
                        name = item.åç§° || 'æœªçŸ¥';
                        desc = item.æè¿° || '';
                        effect = item.æ•ˆæœ || '';
                        quality = item.å“è´¨ || '';
                        origin = item.æ¥æºä¸–ç•Œ || '';
                        type = item.ç±»å‹ || '';
                        hasDetails = desc || effect || quality || origin || type;
                    }
                }
                
                const icon = {'æ­¦å™¨':'âš”ï¸', 'é˜²å…·':'ğŸ›¡ï¸', 'æœè£…':'ğŸ‘•', 'é¥°å“':'ğŸ’'}[slot] || 'ğŸ“¦';
                
                let html = `<div class="item-card" ${hasDetails ? 'style="cursor:pointer;" onclick="toggleCardDetails(this)"' : ''}>`;
                html += `<div class="card-title" style="padding-right: 20px;">${icon} ${slot}: ${name}`;
                if (quality) html += ` <span class="tag">${quality}</span>`;
                if (hasDetails) {
                    html += ' <span class="card-arrow">â–¼</span>';
                }
                html += '</div>';
                
                if (hasDetails) {
                    html += '<div class="card-details">';
                    html += '<div class="card-section">';
                    if (desc) html += `<div class="card-section-content">${desc}</div>`;
                    if (effect) html += `<div class="card-section-content">æ•ˆæœ: ${effect}</div>`;
                    if (origin) html += `<div class="card-section-content">æ¥æº: ${origin}</div>`;
                    html += '</div>';
                    html += '</div>';
                }
                
                html += '</div>';
                return html;
            }).join('');

            // ä»“åº“æ¸…å• (ç²¾ç¾å¡ç‰‡æ ·å¼)
            const inv = data['ä»“åº“æ¸…å•'] || [];
            if (Array.isArray(inv) && inv.length > 0) {
                document.getElementById('list-inventory').innerHTML = inv.map(i => {
                    if (!i) return '';
                    const name = i.åç§° || 'æœªçŸ¥';
                    const count = i.æ•°é‡ || 1;
                    const desc = i.æè¿° || '';
                    const type = i.ç±»å‹ || '';
                    const quality = i.å“è´¨ || '';
                    const effect = i.æ•ˆæœ || '';
                    const origin = i.æ¥æºä¸–ç•Œ || '';
                    
                    const hasDetails = desc || type || quality || effect || origin;
                    
                    let html = `<div class="item-card" ${hasDetails ? 'style="cursor:pointer;" onclick="toggleCardDetails(this)"' : ''}>`;
                    html += `<div class="card-title" style="padding-right: 20px;">${name}`;
                    html += ` <span class="tag">x${count}</span>`;
                    if (quality) html += ` <span class="tag">${quality}</span>`;
                    if (type) html += ` <span class="tag">${type}</span>`;
                    if (hasDetails) {
                        html += ' <span class="card-arrow">â–¼</span>';
                    }
                    html += '</div>';
                    
                    if (hasDetails) {
                        html += '<div class="card-details">';
                        html += '<div class="card-section">';
                        if (desc) html += `<div class="card-section-content">${desc}</div>`;
                        if (quality) html += `<div class="card-section-content">å“è´¨: ${quality}</div>`;
                        if (effect) html += `<div class="card-section-content">æ•ˆæœ: ${effect}</div>`;
                        if (origin) html += `<div class="card-section-content">æ¥æº: ${origin}</div>`;
                        html += '</div>';
                        html += '</div>';
                    }
                    
                    html += '</div>';
                    return html;
                    }).join('');
                } else {
                document.getElementById('list-inventory').innerHTML = '<div class="empty-tip">ä»“åº“ä¸ºç©º</div>';
            }

            // 6. è½½å…·
            document.getElementById('veh-type').innerText = SafeGetFallback(data, ['è½½å…·æ ¸å¿ƒ.ç±»å‹'], '-');
            document.getElementById('veh-core').innerText = SafeGetFallback(data, ['è½½å…·æ ¸å¿ƒ.åç§°'], '-');
            document.getElementById('veh-status').innerText = SafeGetFallback(data, ['è½½å…·æ ¸å¿ƒ.å½“å‰çŠ¶æ€'], '-');
            document.getElementById('veh-stage').innerText = SafeGetFallback(data, ['è½½å…·æ ¸å¿ƒ.åŒæ­¥ç‡é˜¶æ®µ'], '0');
            
            const spUsed = parseFloat(SafeGet(data, 'è½½å…·ç©ºé—´ç»Ÿç­¹.å·²å ç”¨ç©ºé—´', 0));
            const spTotal = parseFloat(SafeGet(data, 'è½½å…·ç©ºé—´ç»Ÿç­¹.æ€»ç©ºé—´', 1000));
            document.getElementById('space-text').innerText = `${spUsed}/${spTotal} SU`;
            document.getElementById('space-bar').style.width = Math.min(100, (spUsed/spTotal)*100) + '%';

            // å»ºç­‘å¸ƒå±€ (ç²¾ç¾å¡ç‰‡æ ·å¼)
            const builds = data['å»ºç­‘å¸ƒå±€ä¸å†…è£…'] || [];
            if (Array.isArray(builds) && builds.length > 0) {
                document.getElementById('list-buildings').innerHTML = builds.map(b => {
                    if (!b) return '';
                    const name = b.name || b.åç§° || 'æœªçŸ¥';
                    const type = b.type || b.ç±»å‹ || 'æ ¸å¿ƒ';
                    const space = b.space || b.è½½å…·å ç”¨ç©ºé—´ || 0;
                    const status = b.status || b.çŠ¶æ€ || '';
                    const description = b.description || b.æè¿° || '';
                    
                    const hasItems = b.items && Array.isArray(b.items) && b.items.length > 0;
                    const hasFunctions = b.åŠŸèƒ½ && Array.isArray(b.åŠŸèƒ½) && b.åŠŸèƒ½.length > 0;
                    const hasDetails = description || hasItems || hasFunctions;
                    
                    let html = `<div class="item-card" ${hasDetails ? 'style="cursor:pointer;" onclick="toggleCardDetails(this)"' : ''}>`;
                    html += `<div class="card-title" style="padding-right: 20px;">${name}`;
                    html += ` <span class="tag">${type}</span>`;
                    if (status) html += ` <span class="tag" style="background:rgba(0,0,0,0.05);">${status}</span>`;
                    if (hasDetails) {
                        html += ' <span class="card-arrow">â–¼</span>';
                    }
                    html += '</div>';
                    
                    html += `<div class="card-info-line">å ç”¨ç©ºé—´: ${space} SU</div>`;
                    
                    if (hasDetails) {
                        html += '<div class="card-details">';
                        
                        if (description) {
                            html += `<div class="card-section"><div class="card-section-content">${description}</div></div>`;
                        }
                        
                        if (hasItems) {
                            html += '<div class="card-section">';
                            html += '<div class="card-section-title">å†…éƒ¨è®¾æ–½:</div>';
                            b.items.forEach(it => {
                                if (!it) return;
                                if (typeof it === 'string') {
                                    html += `<div class="card-section-content">â€¢ ${it}</div>`;
                                        } else {
                                    const itName = it.name || it.åç§° || 'æœªçŸ¥';
                                    const itSpace = it.space || it.è½½å…·å ç”¨ç©ºé—´ || 0;
                                    const itDesc = it.description || it.æè¿° || '';
                                    html += `<div class="card-section-content">â€¢ ${itName} (${itSpace} SU)${itDesc ? ` - ${itDesc}` : ''}</div>`;
                                }
                            });
                            html += '</div>';
                        }
                        
                        if (hasFunctions) {
                            html += '<div class="card-section">';
                            html += '<div class="card-section-title">åŠŸèƒ½:</div>';
                            b.åŠŸèƒ½.forEach(f => {
                                html += `<div class="card-section-content">â€¢ ${f}</div>`;
                            });
                            html += '</div>';
                        }
                        
                        html += '</div>';
                    }
                    
                    html += '</div>';
                    return html;
                }).join('');
                                } else {
                document.getElementById('list-buildings').innerHTML = '<div class="empty-tip">æ— å»ºç­‘</div>';
            }
            
            // æˆå‘˜ç®¡ç† (ç²¾ç¾å¡ç‰‡æ ·å¼)
            const members = data['æˆå‘˜ç®¡ç†'] || [];
            if (Array.isArray(members) && members.length > 0) {
                document.getElementById('list-members').innerHTML = members.map(m => {
                    if (!m) return '';
                    const name = m.å§“å || m.åç§° || 'æœªçŸ¥';
                    const identity = m.èº«ä»½ || m.èŒä¸š || '';
                    const originWorld = m.åŸä¸–ç•Œ || '';
                    const residence = m.å±…ä½åŒº || '';
                    const relation = m.å…³ç³» || '';
                    const affection = m.å¥½æ„Ÿåº¦;
                    const status = m.å½“å‰çŠ¶æ€ || '';
                    const gender = m.æ€§åˆ« || '';
                    
                    const portrait = m.äººç‰©ç”»åƒ || {};
                    const appearance = portrait.å¤–è²Œ || '';
                    const clothing = portrait.è¡£ç€ || '';
                    const figure = portrait.èº«æ || '';
                    
                    const privacy = m.éšç§æ¡£æ¡ˆ || {};
                    const personality = privacy.æ€§æ ¼ || '';
                    const preferences = privacy.å–œå¥½ || '';
                    
                    const equipment = m.è£…å¤‡æ  || {};
                    const weapon = equipment.æ­¦å™¨ ? (equipment.æ­¦å™¨.åç§° || equipment.æ­¦å™¨) : 'ç©º';
                    const armor = equipment.é˜²å…· ? (equipment.é˜²å…·.åç§° || equipment.é˜²å…·) : 'ç©º';
                    
                    const hasDetails = originWorld || residence || appearance || clothing || figure || personality || preferences || (weapon !== 'ç©º') || (armor !== 'ç©º');
                    
                    let html = `<div class="item-card" ${hasDetails ? 'style="cursor:pointer;" onclick="toggleCardDetails(this)"' : ''}>`;
                    html += `<div class="card-title" style="padding-right: 20px;">${name}`;
                    if (hasDetails) {
                        html += ' <span class="card-arrow">â–¼</span>';
                            }
                            html += '</div>';
                            
                    html += '<div class="card-info-line">';
                    if (identity) html += `èº«ä»½: ${identity} | `;
                    if (relation) html += `å…³ç³»: ${relation} | `;
                    if (gender) html += `æ€§åˆ«: ${gender} | `;
                    if (affection !== undefined && affection !== null) html += `å¥½æ„Ÿ: ${affection} | `;
                    if (status) html += `çŠ¶æ€: ${status}`;
                    html += '</div>';
                    
                    if (hasDetails) {
                        html += '<div class="card-details">';
                        
                        if (originWorld || residence) {
                            html += '<div class="card-section">';
                            if (originWorld) html += `<div class="card-section-content">åŸä¸–ç•Œ: ${originWorld}</div>`;
                            if (residence) html += `<div class="card-section-content">å±…ä½åŒº: ${residence}</div>`;
                                    html += '</div>';
                        }
                        
                        if (appearance || clothing || figure) {
                            html += '<div class="card-section">';
                            html += '<div class="card-section-title">äººç‰©ç”»åƒ:</div>';
                            if (appearance) html += `<div class="card-section-content">å¤–è²Œ: ${appearance}</div>`;
                            if (clothing) html += `<div class="card-section-content">è¡£ç€: ${clothing}</div>`;
                            if (figure) html += `<div class="card-section-content">èº«æ: ${figure}</div>`;
                                    html += '</div>';
                                }
                        
                        if (personality || preferences) {
                            html += '<div class="card-section">';
                            html += '<div class="card-section-title">éšç§æ¡£æ¡ˆ:</div>';
                            if (personality) html += `<div class="card-section-content">æ€§æ ¼: ${personality}</div>`;
                            if (preferences) html += `<div class="card-section-content">å–œå¥½: ${preferences}</div>`;
                                    html += '</div>';
                                }
                        
                        if (weapon !== 'ç©º' || armor !== 'ç©º') {
                            html += '<div class="card-section">';
                            html += '<div class="card-section-title">è£…å¤‡:</div>';
                            html += `<div class="card-section-content">âš”ï¸ æ­¦å™¨: ${weapon} | ğŸ›¡ï¸ é˜²å…·: ${armor}</div>`;
                                    html += '</div>';
                                }
                                
                        html += '</div>';
                            }
                            
                    html += '</div>';
                            return html;
                    }).join('');
                } else {
                document.getElementById('list-members').innerHTML = '<div class="empty-tip">æ— æˆå‘˜</div>';
            }

            // 7. ä¸–ç•Œä¿¡æ¯ (å®Œæ•´ç‰ˆ)
            const worldInfo = data['å½“å‰ä¸–ç•Œä¿¡æ¯'] || {};
            
            document.getElementById('world-civ').innerText = worldInfo.æ–‡æ˜ç±»å‹ || '-';
            document.getElementById('world-id').innerText = worldInfo.ä¼ªè£…èº«ä»½ || '-';
            
            // å‰§æƒ…èŠ‚ç‚¹ - å¤šç§å¯èƒ½çš„å­—æ®µå
            const plotNode = worldInfo.ä¸–ç•Œå‰§æƒ…èŠ‚ç‚¹ || worldInfo.å‰§æƒ…èŠ‚ç‚¹ || worldInfo.ä¸–ç•Œå‰§æœ¬èŠ‚ç‚¹ || '-';
            document.getElementById('world-node').innerText = plotNode;
            
            // åŠ›é‡å±‚çº§ - å¤šç§å¯èƒ½çš„å­—æ®µå
            const powerLevel = worldInfo['å½“å‰ä¸–ç•Œ{{user}}åŠ›é‡å±‚çº§'] || worldInfo.å½“å‰ä¸–ç•ŒåŠ›é‡å±‚çº§ || worldInfo['{{user}}åŠ›é‡å±‚çº§'] || worldInfo.åŠ›é‡å±‚çº§ || '-';
            document.getElementById('world-level').innerText = powerLevel;
            
            const bgText = worldInfo.ä¸–ç•ŒèƒŒæ™¯è®¾å®š || 'æš‚æ— ';
            const powerSystem = worldInfo.å½“å‰ä¸–ç•ŒåŠ›é‡ä½“ç³» || worldInfo.åŠ›é‡ä½“ç³» || 'æš‚æ— ';
            const powerLevelDetail = worldInfo.å½“å‰ä¸–ç•ŒåŠ›é‡å±‚çº§ || '';
            const worldRules = worldInfo.å½“å‰ä¸–ç•Œè§„åˆ™ || '';
            
            document.getElementById('world-bg-text').innerText = bgText;
            
            let powerText = '';
            if (powerSystem !== 'æš‚æ— ') {
                powerText += `ã€åŠ›é‡ä½“ç³»ã€‘\n${powerSystem}`;
            }
            if (powerLevelDetail && powerLevelDetail !== powerLevel) {
                powerText += `\n\nã€åŠ›é‡å±‚çº§ã€‘\n${powerLevelDetail}`;
            }
            if (worldRules) {
                powerText += `\n\nã€ä¸–ç•Œè§„åˆ™ã€‘\n${worldRules}`;
            }
            
            document.getElementById('world-power-text').innerText = powerText || 'æš‚æ— ';

            // 8. è§’è‰²å½• (ç²¾ç¾å¡ç‰‡æ ·å¼ - å®Œæ•´ç‰ˆ)
            const npcs = data['ä¸–ç•Œè§’è‰²å½•'] || [];
            if (Array.isArray(npcs) && npcs.length > 0) {
                document.getElementById('list-npcs').innerHTML = npcs.map(n => {
                    if (!n) return '';
                    const name = n.å§“å || 'æœªçŸ¥';
                    const identity = n.èº«ä»½ || '';
                    const relation = n.å…³ç³» || '';
                    const affection = n.å¥½æ„Ÿåº¦ || 0;
                    const status = n.å½“å‰çŠ¶æ€ || '';
                    const gender = n.æ€§åˆ« || '';
                    
                    const portrait = n.äººç‰©ç”»åƒ || {};
                    const appearance = portrait.å¤–è²Œ || '';
                    const clothing = portrait.è¡£ç€ || '';
                    const figure = portrait.èº«æ || '';
                    
                    const privacy = n.éšç§æ¡£æ¡ˆ || {};
                    const personality = privacy.æ€§æ ¼ || '';
                    const preferences = privacy.å–œå¥½ || '';
                    
                    // èƒ½åŠ›é¢æ¿
                    const abilities = n.èƒ½åŠ›é¢æ¿ || {};
                    const attrs = abilities.å±æ€§ || {};
                    const talents = abilities.å¤©èµ‹ || [];
                    const skills = abilities.èƒ½åŠ› || [];
                    
                    // è£…å¤‡æ 
                    const equipment = n.è£…å¤‡æ  || {};
                    const weapon = equipment.æ­¦å™¨;
                    const armor = equipment.é˜²å…·;
                    const accessory = equipment.é¥°å“;
                    
                    // èƒŒåŒ…
                    const backpack = n.èƒŒåŒ… || [];
                    
                    const hasAbilities = Object.keys(attrs).length > 0 || talents.length > 0 || skills.length > 0;
                    const hasEquipment = weapon || armor || accessory;
                    const hasBackpack = backpack.length > 0;
                    const hasDetails = appearance || clothing || figure || personality || preferences || hasAbilities || hasEquipment || hasBackpack;
                    
                    let html = `<div class="item-card" ${hasDetails ? 'style="cursor:pointer;" onclick="toggleCardDetails(this)"' : ''}>`;
                    html += `<div class="card-title" style="padding-right: 20px;">${name}`;
                    if (hasDetails) {
                        html += ' <span class="card-arrow">â–¼</span>';
                            }
                            html += '</div>';
                            
                    html += '<div class="card-info-line">';
                    if (identity) html += `èº«ä»½: ${identity} | `;
                    html += `å…³ç³»: ${relation} | æ€§åˆ«: ${gender || 'æœªçŸ¥'} | å¥½æ„Ÿ: ${affection} | çŠ¶æ€: ${status}</div>`;
                    
                    if (hasDetails) {
                        html += '<div class="card-details">';
                        
                        if (appearance || clothing || figure) {
                            html += '<div class="card-section">';
                            html += '<div class="card-section-title">äººç‰©ç”»åƒ:</div>';
                            if (appearance) html += `<div class="card-section-content">å¤–è²Œ: ${appearance}</div>`;
                            if (clothing) html += `<div class="card-section-content">è¡£ç€: ${clothing}</div>`;
                            if (figure) html += `<div class="card-section-content">èº«æ: ${figure}</div>`;
                                html += '</div>';
                        }
                        
                        if (personality || preferences) {
                            html += '<div class="card-section">';
                            html += '<div class="card-section-title">éšç§æ¡£æ¡ˆ:</div>';
                            if (personality) html += `<div class="card-section-content">æ€§æ ¼: ${personality}</div>`;
                            if (preferences) html += `<div class="card-section-content">å–œå¥½: ${preferences}</div>`;
                                html += '</div>';
                        }
                        
                        if (hasAbilities) {
                            html += '<div class="card-section">';
                            html += '<div class="card-section-title">èƒ½åŠ›é¢æ¿:</div>';
                            
                            if (Object.keys(attrs).length > 0) {
                                let attrStr = [];
                                if (attrs.åŠ›é‡) attrStr.push(`åŠ›é‡: ${attrs.åŠ›é‡}`);
                                if (attrs.é˜²å¾¡) attrStr.push(`é˜²å¾¡: ${attrs.é˜²å¾¡}`);
                                if (attrs.æ•æ·) attrStr.push(`æ•æ·: ${attrs.æ•æ·}`);
                                if (attrs.é­…åŠ›) attrStr.push(`é­…åŠ›: ${attrs.é­…åŠ›}`);
                                if (attrs.å¹¸è¿) attrStr.push(`å¹¸è¿: ${attrs.å¹¸è¿}`);
                                if (attrStr.length > 0) {
                                    html += `<div class="card-section-content">å±æ€§: ${attrStr.join(' | ')}</div>`;
                                }
                            }
                            
                            if (talents.length > 0) {
                                html += `<div class="card-section-content">å¤©èµ‹: ${talents.join('ã€')}</div>`;
                            }
                            
                            if (skills.length > 0) {
                                html += `<div class="card-section-content">èƒ½åŠ›: ${skills.join('ã€')}</div>`;
                            }
                            
                            html += '</div>';
                        }
                        
                        if (hasEquipment) {
                            html += '<div class="card-section">';
                            html += '<div class="card-section-title">è£…å¤‡æ :</div>';
                            
                            if (weapon) {
                                const wName = typeof weapon === 'object' ? (weapon.åç§° || weapon.name || JSON.stringify(weapon)) : weapon;
                                html += `<div class="card-section-content">âš”ï¸ æ­¦å™¨: ${wName}</div>`;
                            }
                            if (armor) {
                                const aName = typeof armor === 'object' ? (armor.åç§° || armor.name || JSON.stringify(armor)) : armor;
                                html += `<div class="card-section-content">ğŸ›¡ï¸ é˜²å…·: ${aName}</div>`;
                            }
                            if (accessory) {
                                const accName = typeof accessory === 'object' ? (accessory.åç§° || accessory.name || JSON.stringify(accessory)) : accessory;
                                const accType = typeof accessory === 'object' ? (accessory.ç±»å‹ || '') : '';
                                const accEffect = typeof accessory === 'object' ? (accessory.æ•ˆæœ || '') : '';
                                html += `<div class="card-section-content">ğŸ’ é¥°å“: ${accName}`;
                                if (accType) html += ` (${accType})`;
                                if (accEffect) html += `<br>&nbsp;&nbsp;&nbsp;&nbsp;æ•ˆæœ: ${accEffect}`;
                                html += `</div>`;
                            }
                            
                            html += '</div>';
                        }
                        
                        if (hasBackpack) {
                            html += '<div class="card-section">';
                            html += '<div class="card-section-title">èƒŒåŒ…:</div>';
                            backpack.forEach(item => {
                                if (item) {
                                    const itemName = typeof item === 'string' ? item : (item.åç§° || 'æœªçŸ¥ç‰©å“');
                                    html += `<div class="card-section-content">â€¢ ${itemName}</div>`;
                                }
                            });
                                html += '</div>';
                        }
                        
                        html += '</div>';
                    }
                    
                            html += '</div>';
                            return html;
                    }).join('');
                } else {
                document.getElementById('list-npcs').innerHTML = '<div class="empty-tip">æ— è®°å½•</div>';
            }
            
            // åŠ¿åŠ›æ¡£æ¡ˆ (ç²¾ç¾å¡ç‰‡æ ·å¼)
            const factions = data['ä¸–ç•ŒåŠ¿åŠ›æ¡£æ¡ˆ'] || [];
            if (Array.isArray(factions) && factions.length > 0) {
                document.getElementById('list-factions').innerHTML = factions.map(f => {
                    if (!f) return '';
                    const name = f.åŠ¿åŠ›åç§° || f.åç§° || 'æœªçŸ¥';
                    const type = f.ç±»å‹ || '';
                    const location = f.åœ°ç†ä½ç½® || '';
                    const leader = typeof f.é¢†å¯¼è€… === 'object' ? (f.é¢†å¯¼è€….å§“å || '') : (f.é¢†å¯¼è€… || '');
                    const attitude = f.å¯¹ä¸»è§’æ€åº¦ || '';
                    const currentState = f.å½“å‰çŠ¶æ€ || '';
                    const resources = f.èµ„æºå‚¨å¤‡ || '';
                    const influence = f.å½±å“åŠ› || '';
                    
                    const hasDetails = location || leader || attitude || currentState || resources || influence;
                    
                    let html = `<div class="item-card" ${hasDetails ? 'style="cursor:pointer;" onclick="toggleCardDetails(this)"' : ''}>`;
                    html += `<div class="card-title" style="padding-right: 20px;">${name}`;
                    if (type) html += ` <span class="tag">${type}</span>`;
                    if (hasDetails) {
                        html += ' <span class="card-arrow">â–¼</span>';
                    }
                    html += '</div>';
                    
                    if (hasDetails) {
                        html += '<div class="card-details">';
                        html += '<div class="card-section">';
                        if (location) html += `<div class="card-section-content">åœ°ç†ä½ç½®: ${location}</div>`;
                        if (leader) html += `<div class="card-section-content">é¢†å¯¼è€…: ${leader}</div>`;
                        if (attitude) html += `<div class="card-section-content">å¯¹ä¸»è§’æ€åº¦: ${attitude}</div>`;
                        if (currentState) html += `<div class="card-section-content">å½“å‰çŠ¶æ€: ${currentState}</div>`;
                        if (influence) html += `<div class="card-section-content">å½±å“åŠ›: ${influence}</div>`;
                        if (resources) {
                            const resStr = typeof resources === 'string' ? resources : JSON.stringify(resources);
                            html += `<div class="card-section-content">èµ„æºå‚¨å¤‡: ${resStr}</div>`;
                        }
                        html += '</div>';
                        html += '</div>';
                    }
                    
                    html += '</div>';
                    return html;
                }).join('');
                        } else {
                document.getElementById('list-factions').innerHTML = '<div class="empty-tip">æ— è®°å½•</div>';
            }

            // 9. å‘½è¿æ¸…å• (ç²¾ç¾å¡ç‰‡æ ·å¼)
            const destiny = data['ä¸–ç•Œå‘½è¿æ¸…å•'] || [];
            if (Array.isArray(destiny) && destiny.length > 0) {
                document.getElementById('list-missions').innerHTML = destiny.map(d => {
                    if (!d) return '';
                    const title = d.å‘½è¿çº¿åç§° || 'æœªçŸ¥';
                    const lv = d.ç­‰çº§ || 'ç®€å•';
                    const bg = d.å‘½è¿èƒŒæ™¯ || '';
                    const totalOrigin = parseFloat(String(d.æœ¬æºæ¡†æ¶ || 0).replace(/[^0-9.-]/g, '')) || 0;
                    
                    const nodes = d.å‘½è¿èŠ‚ç‚¹ || [];
                    let completedCount = 0;
                    let obtainedOrigin = 0;
                    let allResolved = false;
                    
                    const nodeHtml = Array.isArray(nodes) ? nodes.map(n => {
                        if (!n) return '';
                        
                        let nodeDesc = '';
                                let nodeStatus = 'æœªåè½¬';
                        let nodeEval = '';
                                let nodeOrigin = 0;
                                let failReason = '';
                                
                        if (typeof n === 'string') {
                            nodeDesc = n.replace(/^[âœ“âœ—â–¡]\s*/, '');
                            if (n.startsWith('âœ“')) nodeStatus = 'å·²åè½¬';
                            if (n.startsWith('âœ—')) nodeStatus = 'å·²å¤±è´¥';
                                    } else {
                            nodeDesc = n.æè¿° || 'æœªçŸ¥èŠ‚ç‚¹';
                            nodeStatus = n.çŠ¶æ€ || 'æœªåè½¬';
                            nodeEval = n.åè½¬è¯„ä»· || '';
                            nodeOrigin = parseFloat(String(n.è·å¾—æœ¬æº || 0).replace(/[^0-9.-]/g, '')) || 0;
                            failReason = n.å¤±è´¥åŸå›  || '';
                                }
                                
                                const isCompleted = nodeStatus === 'å·²åè½¬';
                                const isFailed = nodeStatus === 'å·²å¤±è´¥';
                                
                        if (isCompleted) {
                            completedCount++;
                            obtainedOrigin += nodeOrigin;
                        }
                                
                        let icon = 'â–¡';
                        let style = '';
                                if (isCompleted) {
                            icon = 'âœ“';
                            style = 'color:var(--success);text-decoration:line-through;';
                                } else if (isFailed) {
                            icon = 'âœ—';
                            style = 'color:var(--text-sub);text-decoration:line-through;opacity:0.6;';
                        }
                        
                        let extra = '';
                        if (isCompleted && (nodeEval || nodeOrigin > 0)) {
                            extra = `<div style="margin-left:20px; font-size:11px; color:var(--text-sub); margin-top:2px;">`;
                            if (nodeEval) extra += `è¯„ä»·: ${nodeEval} `;
                            if (nodeOrigin > 0) extra += `<span style="color:var(--energy); font-weight:600;">+${nodeOrigin} pts</span>`;
                            extra += `</div>`;
                        }
                        if (isFailed && failReason) {
                            extra = `<div style="margin-left:20px; font-size:11px; color:var(--text-sub); margin-top:2px;">å¤±è´¥: ${failReason}</div>`;
                        }
                        
                        return `<div style="${style}; margin-bottom:6px;">${icon} ${nodeDesc}${extra}</div>`;
                    }).join('') : '';
                    
                    allResolved = nodes.length > 0 && nodes.every(n => {
                        if (!n) return false;
                        const status = typeof n === 'string' ? (n.startsWith('âœ“') || n.startsWith('âœ—')) : (n.çŠ¶æ€ === 'å·²åè½¬' || n.çŠ¶æ€ === 'å·²å¤±è´¥');
                        return status;
                    });
                    
                    const isFinished = completedCount === nodes.length && nodes.length > 0;
                    const originPercent = totalOrigin > 0 ? Math.min(100, (obtainedOrigin / totalOrigin) * 100) : 0;
                    
                    let statusBadge = '';
                    if (isFinished) {
                        statusBadge = '<span class="tag" style="background:var(--success);color:white;border:none;">âœ“ å·²å®Œæˆ</span>';
                    } else if (allResolved) {
                        statusBadge = '<span class="tag" style="background:#999;color:white;border:none;">å·²ç»“æŸ</span>';
                } else {
                        statusBadge = '<span class="tag" style="color:var(--success);border-color:var(--success);">è¿›è¡Œä¸­</span>';
                    }
                    
                    let html = '<div class="item-card open" style="cursor:pointer;" onclick="toggleCardDetails(this)">';
                    html += `<div class="card-title" style="padding-right: 20px;">${title}`;
                    html += ` <span class="tag">${lv}</span>`;
                    html += ` ${statusBadge}`;
                    html += ' <span class="card-arrow" style="transform:rotate(180deg)">â–¼</span>';
                    html += '</div>';
                    
                    if (bg) {
                        html += `<div class="card-info-line">${bg}</div>`;
                    }
                    
                    html += '<div class="card-details active" style="display:block;">';
                    html += `<div style="margin-bottom:12px;">${nodeHtml||'æ— èŠ‚ç‚¹'}</div>`;
                    html += '<div class="bar-wrap" style="margin:0;">';
                    html += '<div class="bar-info">';
                    html += `<span>${allResolved ? 'ğŸ”’' : 'ğŸ’'} æœ¬æºè¿›åº¦</span>`;
                    html += `<span>${Math.floor(totalOrigin)} pts</span>`;
                            html += '</div>';
                    html += '<div class="bar-bg">';
                    html += `<div class="bar-fill" style="width:${originPercent}%; background:${allResolved ? '#999' : 'var(--energy)'}"></div>`;
                            html += '</div>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';
                    
                            return html;
                    }).join('');
                } else {
                document.getElementById('list-missions').innerHTML = '<div class="empty-tip">æš‚æ— å‘½è¿çº¿</div>';
            }

        } catch (e) {
            console.error(e);
            document.getElementById('terminal-log').innerHTML = `<div class="error-tip">æ•°æ®åŠ è½½é”™è¯¯: ${e.message}</div>`;
        }
    }

    (function() {
        if(!document.documentElement.getAttribute('data-theme')) {
            document.documentElement.setAttribute('data-theme', 'light');
        }
        initDisplay();
    })();
</script>
</body>
</html>
